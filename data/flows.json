[{"id":"5af3cb51.dbf004","type":"tab","label":"Monitoring","disabled":false,"info":""},{"id":"9d2b2e9.fa765d","type":"mqtt-broker","z":"","name":"","broker":"<###MQTT_SERVER###>","port":"1883","clientid":"<###NODE_NAME###>","usetls":false,"compatmode":true,"keepalive":"60","cleansession":true,"birthTopic":"","birthQos":"0","birthPayload":"","closeTopic":"","closeQos":"0","closePayload":"","willTopic":"","willQos":"0","willPayload":""},{"id":"1e7b1e5f.eae4a2","type":"inject","z":"5af3cb51.dbf004","name":"","topic":"","payload":"","payloadType":"date","repeat":"2","crontab":"","once":false,"onceDelay":0.1,"x":130,"y":80,"wires":[["63daa647.18c328"]]},{"id":"5e9fd693.0e4408","type":"mqtt out","z":"5af3cb51.dbf004","name":"","topic":"/heartbeats/<###NODE_NAME###>/","qos":"","retain":"","broker":"9d2b2e9.fa765d","x":690,"y":80,"wires":[]},{"id":"63daa647.18c328","type":"function","z":"5af3cb51.dbf004","name":"set heartbeat","func":"osUtils = global.get('osUtils')\n\npayload = {\n    timestamp: msg.payload,\n    deviceName: '<###NODE_NAME###>',\n}\n\nreturn {payload} ;","outputs":1,"noerr":0,"x":310,"y":80,"wires":[["28c55e2b.d79b22"]]},{"id":"28c55e2b.d79b22","type":"json","z":"5af3cb51.dbf004","name":"","property":"payload","action":"","pretty":true,"x":470,"y":80,"wires":[["5e9fd693.0e4408"]]},{"id":"883dad9d.1bb2d","type":"mqtt in","z":"5af3cb51.dbf004","name":"","topic":"/devices/<###NODE_NAME###>/commands/in/benchmark_cpu","qos":"2","datatype":"auto","broker":"9d2b2e9.fa765d","x":230,"y":180,"wires":[["9b29ab34.1d0998"]]},{"id":"59135c10.105b94","type":"mqtt out","z":"5af3cb51.dbf004","name":"","topic":"/devices/<###NODE_NAME###>/commands/out/benchmark_cpu","qos":"","retain":"","broker":"9d2b2e9.fa765d","x":860,"y":180,"wires":[]},{"id":"9b29ab34.1d0998","type":"exec","z":"5af3cb51.dbf004","command":"sysbench --test=cpu --cpu-max-prime=2000 run | grep 'total time:' | sed \"s/total time://g\" | sed -e 's/^[ \\t]*//'","addpay":false,"append":"","useSpawn":"false","timer":"","oldrc":false,"name":"benchmark cpu","x":540,"y":180,"wires":[["59135c10.105b94"],[],[]]},{"id":"a0487ab.703ea88","type":"exec","z":"5af3cb51.dbf004","command":"ping -c 4 ","addpay":true,"append":"","useSpawn":"false","timer":"10","oldrc":false,"name":"ping","x":530,"y":260,"wires":[["587370ef.2ff82"],[],[]]},{"id":"587370ef.2ff82","type":"mqtt out","z":"5af3cb51.dbf004","name":"","topic":"/devices/<###NODE_NAME###>/commands/out/ping","qos":"","retain":"","broker":"9d2b2e9.fa765d","x":780,"y":260,"wires":[]},{"id":"1339e1c4.48e57e","type":"mqtt in","z":"5af3cb51.dbf004","name":"","topic":"/devices/<###NODE_NAME###>/commands/in/ping","qos":"2","datatype":"auto","broker":"9d2b2e9.fa765d","x":200,"y":260,"wires":[["a0487ab.703ea88"]]},{"id":"e92174b2.465c58","type":"mqtt in","z":"5af3cb51.dbf004","name":"","topic":"/devices/<###NODE_NAME###>/commands/in/iperf3","qos":"2","datatype":"auto","broker":"9d2b2e9.fa765d","x":200,"y":360,"wires":[["1c4cf2aa.f757cd"]]},{"id":"1c4cf2aa.f757cd","type":"exec","z":"5af3cb51.dbf004","command":"iperf3 -t 2 -c ","addpay":true,"append":"","useSpawn":"false","timer":"10","oldrc":false,"name":"iperf3","x":530,"y":360,"wires":[["cee0b41c.4b8f98"],[],[]]},{"id":"cee0b41c.4b8f98","type":"mqtt out","z":"5af3cb51.dbf004","name":"","topic":"/devices/<###NODE_NAME###>/commands/out/iperf3","qos":"","retain":"","broker":"9d2b2e9.fa765d","x":790,"y":360,"wires":[]},{"id":"603f5eec.5ca6a","type":"mqtt in","z":"5af3cb51.dbf004","name":"","topic":"/devices/<###NODE_NAME###>/commands/in/sysinfo","qos":"2","datatype":"auto","broker":"9d2b2e9.fa765d","x":210,"y":460,"wires":[["b427ad3c.3b9ae"]]},{"id":"b427ad3c.3b9ae","type":"function","z":"5af3cb51.dbf004","name":"get load","func":"osUtils = global.get('osUtils')\n\npayload = {\n    timestamp: new Date(),\n    deviceName: 'raspi-01',\n    totalMem: osUtils.totalmem(),\n    freeMem: osUtils.freemem(),\n    cpuCount: osUtils.cpuCount(),\n    loadAvg1: osUtils.loadavg(1),\n    loadAvg5: osUtils.loadavg(5),\n    loadAvg15: osUtils.loadavg(15),\n    connectedHardware: JSON.parse(env.get('CONNECTED_HARDWARE'))\n}\n\nreturn {payload} ;","outputs":1,"noerr":0,"x":500,"y":460,"wires":[["378a9ac3.324206"]]},{"id":"378a9ac3.324206","type":"json","z":"5af3cb51.dbf004","name":"","property":"payload","action":"","pretty":true,"x":650,"y":460,"wires":[["eb73aad1.d24638"]]},{"id":"eb73aad1.d24638","type":"mqtt out","z":"5af3cb51.dbf004","name":"","topic":"/devices/<###NODE_NAME###>/commands/out/sysinfo","qos":"","retain":"","broker":"9d2b2e9.fa765d","x":910,"y":460,"wires":[]}]