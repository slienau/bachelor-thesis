<html>

<head>
    <title>Object Detection Web Application</title>
    <style>
        img {
            width: 100%;
            height: auto;
        }

        button, label {
            background-color: #4CAF50; /* Green */
            border: none;
            color: white;
            padding: 15px 32px;
            text-align: center;
            text-decoration: none;
            display: inline-block;
            font-size: 16px;
        }
    </style>
</head>

<body>
<h1>Object Detection Web Application</h1>
<div>
    <h2>Upload</h2>
    <label for="image-file">Choose file</label>
    <input id="image-file" type="file" style="display: none"/>
    <button onclick="onButtonClick()">Detect image</button>
</div>
<hr>
<div>
    <div id="image-original-container" style="display: block">
        <button onclick="onToggleClick()">Show detected image</button>
        <h3>Original Image</h3>
        <img id="image-original"/>
    </div>
    <div id="image-detected-container" style="display: none">
        <button onclick="onToggleClick()">Show original image</button>
        <h3>Detected Image</h3>
        <img id="image-detected"/>
    </div>
</div>
<script>
  const onToggleClick = () => {
    toggleDisplay('image-original-container')
    toggleDisplay('image-detected-container')
  }
  const toggleDisplay = (id) => {
    const element = document.getElementById(id)
    if (element.style.display === 'none') {
      element.style.display = 'block'
    } else {
      element.style.display = 'none'
    }
  }
  const showDetectedImage = () => {
    const element = document.getElementById('image-detected-container')
    if (element.style.display === 'none')
      onToggleClick()
  }
  const showOriginalImage = () => {
    const element = document.getElementById('image-original-container')
    if (element.style.display === 'none')
      onToggleClick()
  }
  const replaceImageData = (elementId, imageData) => {
    const element = document.getElementById(elementId)
    element.src = window.URL.createObjectURL(imageData)
    element.style.display = 'block'
  }
  const clearImage = (elementId) => {
    const element = document.getElementById(elementId)
    element.removeAttribute('src')
    element.style.display = 'none'
  }
  const onButtonClick = () => {
    clearImage('image-detected')
    showOriginalImage()
    const url = 'http://dsl89.ddns.net:1882/od/detector'
    const originalImageData = document.getElementById('image-file').files[0]
    replaceImageData('image-original', originalImageData)
    console.log(`Going to upload image to ${url} for detection`, originalImageData)

    const params = {
      headers: {
        'content-type': 'image/jpeg'
      },
      body: originalImageData,
      method: 'POST',
      responseType: 'blob'
    }
    fetch(url, params)
      .then(data => data.blob())
      .then(res => {
        console.log('Response', res)
        replaceImageData('image-detected', res)
        showDetectedImage()
      })
      .catch(error => console.error(error))
  }
</script>
</body>

</html>